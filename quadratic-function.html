<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>2æ¬¡é–¢æ•°ã‚°ãƒ©ãƒ•æ¢ç©¶ y = a(x-p)Â² + q</title>
  <style>
    /* ============================================
       åŸºæœ¬ãƒªã‚»ãƒƒãƒˆã¨ãƒ•ã‚©ãƒ³ãƒˆ
       ============================================ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    :root {
      /* ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆï¼šè½ã¡ç€ã„ãŸæ•™è‚²çš„ãªé…è‰² */
      --bg-primary: #f8fafc;
      --bg-secondary: #ffffff;
      --bg-dark: #1e293b;
      --accent-blue: #3b82f6;
      --accent-green: #10b981;
      --accent-orange: #f59e0b;
      --accent-pink: #ec4899;
      --accent-purple: #8b5cf6;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --text-muted: #94a3b8;
      --border-color: #e2e8f0;
      --graph-line: #3b82f6;
      --graph-grid: #e2e8f0;
      --graph-axis: #64748b;
      --vertex-color: #ef4444;
      --axis-line-color: #f59e0b;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', 'Meiryo', sans-serif;
      background: var(--bg-primary);
      min-height: 100vh;
      min-height: 100dvh;
      color: var(--text-primary);
      overflow: hidden;
      touch-action: manipulation;
    }

    /* ============================================
       ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ï¼šæ¨ªä¸¦ã³ï¼‰
       ============================================ */
    .container {
      display: grid;
      grid-template-columns: 1fr 340px;
      grid-template-rows: 1fr;
      height: 100vh;
      height: 100dvh;
      gap: 0;
    }

    /* ============================================
       å·¦å´ï¼šã‚°ãƒ©ãƒ•é ˜åŸŸ
       ============================================ */
    .graph-area {
      display: flex;
      flex-direction: column;
      background: var(--bg-secondary);
      position: relative;
    }

    /* å¼ã®è¡¨ç¤ºãƒãƒ¼ */
    .formula-bar {
      background: linear-gradient(135deg, var(--bg-dark) 0%, #334155 100%);
      padding: 16px 24px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }

    .formula-display {
      font-size: 1.6rem;
      font-weight: 600;
      color: #fff;
      font-family: 'Times New Roman', 'Hiragino Mincho ProN', serif;
      letter-spacing: 0.02em;
    }

    .formula-highlight {
      color: var(--accent-orange);
      font-weight: 700;
    }

    .formula-vertex {
      font-size: 1rem;
      color: var(--text-muted);
      background: rgba(255,255,255,0.1);
      padding: 6px 14px;
      border-radius: 20px;
    }

    .formula-vertex span {
      color: var(--vertex-color);
      font-weight: 600;
    }

    /* ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚³ãƒ³ãƒ†ãƒŠ */
    .canvas-container {
      flex: 1;
      position: relative;
      min-height: 0;
    }

    #graphCanvas {
      width: 100%;
      height: 100%;
      display: block;
      cursor: crosshair;
    }

    /* ã‚°ãƒ©ãƒ•ä¸Šã®æƒ…å ±è¡¨ç¤º */
    .graph-info {
      position: absolute;
      top: 12px;
      left: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .info-badge {
      background: rgba(255,255,255,0.95);
      padding: 8px 14px;
      border-radius: 10px;
      font-size: 0.85rem;
      font-weight: 500;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      border: 1px solid var(--border-color);
    }

    .info-badge.convex-up {
      border-left: 4px solid var(--accent-pink);
    }

    .info-badge.convex-down {
      border-left: 4px solid var(--accent-blue);
    }

    .info-badge .label {
      color: var(--text-secondary);
      font-size: 0.75rem;
    }

    .info-badge .value {
      font-weight: 700;
      font-size: 1rem;
    }

    /* å‡¡ä¾‹ */
    .legend {
      position: absolute;
      bottom: 12px;
      left: 12px;
      background: rgba(255,255,255,0.95);
      padding: 10px 14px;
      border-radius: 10px;
      font-size: 0.8rem;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .legend-line {
      width: 20px;
      height: 3px;
      border-radius: 2px;
    }

    .legend-line.parabola { background: var(--graph-line); }
    .legend-line.axis-line { 
      background: var(--axis-line-color); 
      height: 2px;
      border: 1px dashed var(--axis-line-color);
      background: transparent;
    }

    .legend-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--vertex-color);
    }

    /* ============================================
       å³å´ï¼šã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«
       ============================================ */
    .control-panel {
      background: var(--bg-secondary);
      border-left: 1px solid var(--border-color);
      padding: 24px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      overflow-y: auto;
    }

    .panel-header {
      text-align: center;
      padding-bottom: 16px;
      border-bottom: 2px solid var(--border-color);
    }

    .panel-title {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    .panel-subtitle {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    /* ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚«ãƒ¼ãƒ‰ */
    .param-card {
      background: var(--bg-primary);
      border-radius: 16px;
      padding: 18px;
      border: 1px solid var(--border-color);
      transition: box-shadow 0.2s;
    }

    .param-card:hover {
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }

    .param-card.highlight-a { border-left: 4px solid var(--accent-blue); }
    .param-card.highlight-p { border-left: 4px solid var(--accent-green); }
    .param-card.highlight-q { border-left: 4px solid var(--accent-purple); }

    .param-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .param-name {
      font-size: 1.1rem;
      font-weight: 700;
      font-family: 'Times New Roman', serif;
    }

    .param-name.a { color: var(--accent-blue); }
    .param-name.p { color: var(--accent-green); }
    .param-name.q { color: var(--accent-purple); }

    .param-value {
      font-size: 1.4rem;
      font-weight: 700;
      font-family: 'SF Mono', 'Menlo', monospace;
      color: var(--text-primary);
      min-width: 60px;
      text-align: right;
    }

    .param-desc {
      font-size: 0.8rem;
      color: var(--text-secondary);
      margin-bottom: 14px;
      line-height: 1.5;
    }

    /* ã‚«ã‚¹ã‚¿ãƒ ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ */
    .slider-container {
      position: relative;
    }

    input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 10px;
      border-radius: 5px;
      background: linear-gradient(90deg, var(--border-color), var(--border-color));
      outline: none;
      cursor: pointer;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2), 0 0 0 3px var(--accent-blue);
      cursor: pointer;
      transition: transform 0.15s, box-shadow 0.15s;
    }

    input[type="range"]::-webkit-slider-thumb:hover {
      transform: scale(1.1);
    }

    input[type="range"]::-webkit-slider-thumb:active {
      transform: scale(0.95);
      box-shadow: 0 2px 8px rgba(0,0,0,0.3), 0 0 0 4px var(--accent-blue);
    }

    input[type="range"]::-moz-range-thumb {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2), 0 0 0 3px var(--accent-blue);
      cursor: pointer;
      border: none;
    }

    .slider-a::-webkit-slider-thumb { box-shadow: 0 2px 8px rgba(0,0,0,0.2), 0 0 0 3px var(--accent-blue); }
    .slider-p::-webkit-slider-thumb { box-shadow: 0 2px 8px rgba(0,0,0,0.2), 0 0 0 3px var(--accent-green); }
    .slider-q::-webkit-slider-thumb { box-shadow: 0 2px 8px rgba(0,0,0,0.2), 0 0 0 3px var(--accent-purple); }

    .slider-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.7rem;
      color: var(--text-muted);
      margin-top: 6px;
    }

    /* ãƒ—ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ */
    .preset-section {
      background: var(--bg-primary);
      border-radius: 16px;
      padding: 16px;
      border: 1px solid var(--border-color);
    }

    .preset-title {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .preset-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .preset-btn {
      padding: 10px 12px;
      border: 1px solid var(--border-color);
      border-radius: 10px;
      background: var(--bg-secondary);
      font-size: 0.8rem;
      font-weight: 500;
      color: var(--text-primary);
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }

    .preset-btn:hover {
      background: var(--accent-blue);
      color: #fff;
      border-color: var(--accent-blue);
      transform: translateY(-1px);
    }

    .preset-btn:active {
      transform: translateY(0);
    }

    /* ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ */
    .reset-btn {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--bg-dark) 0%, #475569 100%);
      color: #fff;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-top: auto;
    }

    .reset-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.2);
    }

    .reset-btn:active {
      transform: translateY(0);
    }

    /* è£œè¶³æƒ…å ± */
    .tips-box {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border-radius: 12px;
      padding: 14px;
      font-size: 0.8rem;
      color: #92400e;
      line-height: 1.6;
    }

    .tips-box strong {
      display: block;
      margin-bottom: 6px;
      font-size: 0.85rem;
    }

    /* ============================================
       ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆå¯¾å¿œ (900pxä»¥ä¸‹)
       ============================================ */
    @media (max-width: 900px) {
      .container {
        grid-template-columns: 1fr;
        grid-template-rows: auto 1fr auto;
      }

      .formula-bar {
        order: 1;
        padding: 12px 16px;
      }

      .formula-display {
        font-size: 1.3rem;
      }

      .graph-area {
        order: 2;
      }

      .control-panel {
        order: 3;
        border-left: none;
        border-top: 1px solid var(--border-color);
        padding: 16px;
        gap: 14px;
        max-height: 45vh;
      }

      .panel-header {
        display: none;
      }

      .param-card {
        padding: 14px;
      }

      .tips-box {
        display: none;
      }

      .preset-section {
        padding: 12px;
      }
    }

    /* ============================================
       ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³å¯¾å¿œ (480pxä»¥ä¸‹)
       ============================================ */
    @media (max-width: 480px) {
      .formula-bar {
        padding: 10px 12px;
        gap: 10px;
      }

      .formula-display {
        font-size: 1.1rem;
      }

      .formula-vertex {
        font-size: 0.85rem;
        padding: 4px 10px;
      }

      .control-panel {
        padding: 12px;
        gap: 12px;
        max-height: 50vh;
      }

      .param-card {
        padding: 12px;
        border-radius: 12px;
      }

      .param-header {
        margin-bottom: 8px;
      }

      .param-name {
        font-size: 1rem;
      }

      .param-value {
        font-size: 1.2rem;
      }

      .param-desc {
        font-size: 0.75rem;
        margin-bottom: 10px;
      }

      input[type="range"] {
        height: 8px;
      }

      input[type="range"]::-webkit-slider-thumb {
        width: 32px;
        height: 32px;
      }

      .preset-grid {
        grid-template-columns: 1fr 1fr;
        gap: 6px;
      }

      .preset-btn {
        padding: 10px 8px;
        font-size: 0.75rem;
      }

      .reset-btn {
        padding: 12px;
        font-size: 0.9rem;
      }

      .graph-info {
        top: 8px;
        left: 8px;
        gap: 6px;
      }

      .info-badge {
        padding: 6px 10px;
        font-size: 0.75rem;
      }

      .legend {
        bottom: 8px;
        left: 8px;
        padding: 8px 10px;
        font-size: 0.7rem;
      }
    }

    /* æ¨ªå‘ãã‚¹ãƒãƒ›å¯¾å¿œ */
    @media (max-height: 500px) and (orientation: landscape) {
      .container {
        grid-template-columns: 1fr 280px;
        grid-template-rows: 1fr;
      }

      .formula-bar {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        z-index: 10;
        padding: 8px 16px;
        background: rgba(30, 41, 59, 0.95);
      }

      .canvas-container {
        padding-top: 50px;
      }

      .control-panel {
        border-left: 1px solid var(--border-color);
        border-top: none;
        max-height: none;
        padding: 12px;
        gap: 10px;
      }

      .param-card {
        padding: 10px;
      }

      .preset-section, .tips-box {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- å·¦å´ï¼šã‚°ãƒ©ãƒ•é ˜åŸŸ -->
    <div class="graph-area">
      <!-- å¼ã®è¡¨ç¤ºãƒãƒ¼ -->
      <div class="formula-bar">
        <div class="formula-display" id="formulaDisplay">
          y = <span class="formula-highlight" id="formulaA">1</span>(x âˆ’ <span class="formula-highlight" id="formulaP">0</span>)Â² + <span class="formula-highlight" id="formulaQ">0</span>
        </div>
        <div class="formula-vertex">
          é ‚ç‚¹ (<span id="vertexX">0</span>, <span id="vertexY">0</span>)
        </div>
      </div>

      <!-- ã‚­ãƒ£ãƒ³ãƒã‚¹ -->
      <div class="canvas-container">
        <canvas id="graphCanvas"></canvas>

        <!-- ã‚°ãƒ©ãƒ•ä¸Šã®æƒ…å ± -->
        <div class="graph-info">
          <div class="info-badge" id="convexBadge">
            <div class="label">ã‚°ãƒ©ãƒ•ã®å‘ã</div>
            <div class="value" id="convexText">ä¸‹ã«å‡¸ âˆª</div>
          </div>
          <div class="info-badge">
            <div class="label">å¯¾ç§°è»¸</div>
            <div class="value" id="axisText">x = 0</div>
          </div>
        </div>

        <!-- å‡¡ä¾‹ -->
        <div class="legend">
          <div class="legend-item">
            <div class="legend-line parabola"></div>
            <span>æ”¾ç‰©ç·š</span>
          </div>
          <div class="legend-item">
            <div class="legend-line axis-line"></div>
            <span>å¯¾ç§°è»¸</span>
          </div>
          <div class="legend-item">
            <div class="legend-dot"></div>
            <span>é ‚ç‚¹</span>
          </div>
        </div>
      </div>
    </div>

    <!-- å³å´ï¼šã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« -->
    <div class="control-panel">
      <div class="panel-header">
        <div class="panel-title">ğŸ“ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´</div>
        <div class="panel-subtitle">ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’å‹•ã‹ã—ã¦ã‚°ãƒ©ãƒ•ã®å¤‰åŒ–ã‚’è¦³å¯Ÿã—ã‚ˆã†</div>
      </div>

      <!-- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ a -->
      <div class="param-card highlight-a">
        <div class="param-header">
          <span class="param-name a">a</span>
          <span class="param-value" id="valueA">1.0</span>
        </div>
        <div class="param-desc">
          ã‚°ãƒ©ãƒ•ã®ã€Œé–‹ãå…·åˆã€ã¨ã€Œå‘ãã€ã‚’æ±ºã‚ã‚‹<br>
          æ­£ â†’ ä¸‹ã«å‡¸ ï¼ è²  â†’ ä¸Šã«å‡¸
        </div>
        <div class="slider-container">
          <input type="range" class="slider-a" id="sliderA" min="-3" max="3" step="0.1" value="1">
          <div class="slider-labels">
            <span>-3</span>
            <span>0</span>
            <span>3</span>
          </div>
        </div>
      </div>

      <!-- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ p -->
      <div class="param-card highlight-p">
        <div class="param-header">
          <span class="param-name p">p</span>
          <span class="param-value" id="valueP">0.0</span>
        </div>
        <div class="param-desc">
          é ‚ç‚¹ã®xåº§æ¨™ï¼ˆæ¨ªæ–¹å‘ã®ç§»å‹•ï¼‰<br>
          æ­£ â†’ å³ã¸ ï¼ è²  â†’ å·¦ã¸
        </div>
        <div class="slider-container">
          <input type="range" class="slider-p" id="sliderP" min="-5" max="5" step="0.1" value="0">
          <div class="slider-labels">
            <span>-5</span>
            <span>0</span>
            <span>5</span>
          </div>
        </div>
      </div>

      <!-- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ q -->
      <div class="param-card highlight-q">
        <div class="param-header">
          <span class="param-name q">q</span>
          <span class="param-value" id="valueQ">0.0</span>
        </div>
        <div class="param-desc">
          é ‚ç‚¹ã®yåº§æ¨™ï¼ˆç¸¦æ–¹å‘ã®ç§»å‹•ï¼‰<br>
          æ­£ â†’ ä¸Šã¸ ï¼ è²  â†’ ä¸‹ã¸
        </div>
        <div class="slider-container">
          <input type="range" class="slider-q" id="sliderQ" min="-5" max="5" step="0.1" value="0">
          <div class="slider-labels">
            <span>-5</span>
            <span>0</span>
            <span>5</span>
          </div>
        </div>
      </div>

      <!-- ãƒ—ãƒªã‚»ãƒƒãƒˆ -->
      <div class="preset-section">
        <div class="preset-title">âš¡ ã‚¯ã‚¤ãƒƒã‚¯è¨­å®š</div>
        <div class="preset-grid">
          <button class="preset-btn" data-a="1" data-p="0" data-q="0">y = xÂ²</button>
          <button class="preset-btn" data-a="-1" data-p="0" data-q="0">y = -xÂ²</button>
          <button class="preset-btn" data-a="2" data-p="0" data-q="0">y = 2xÂ²</button>
          <button class="preset-btn" data-a="0.5" data-p="0" data-q="0">y = Â½xÂ²</button>
          <button class="preset-btn" data-a="1" data-p="2" data-q="-3">é ‚ç‚¹(2,-3)</button>
          <button class="preset-btn" data-a="-1" data-p="-1" data-q="4">é ‚ç‚¹(-1,4)</button>
        </div>
      </div>

      <!-- ãƒ’ãƒ³ãƒˆ -->
      <div class="tips-box">
        <strong>ğŸ’¡ è¦³å¯Ÿã®ãƒã‚¤ãƒ³ãƒˆ</strong>
        a = 0 ã«ã™ã‚‹ã¨ã©ã†ãªã‚‹ï¼Ÿ<br>
        |a| ã‚’å¤§ããã™ã‚‹ã¨ã‚°ãƒ©ãƒ•ã¯åºƒãŒã‚‹ï¼Ÿç‹­ã¾ã‚‹ï¼Ÿ
      </div>

      <!-- ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ -->
      <button class="reset-btn" id="resetBtn">
        â†º åˆæœŸçŠ¶æ…‹ã«æˆ»ã™
      </button>
    </div>
  </div>

  <script>
    // ============================================
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
    // ============================================
    let canvas, ctx;
    let a = 1, p = 0, q = 0;  // 2æ¬¡é–¢æ•°ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

    // è¡¨ç¤ºç¯„å›²ï¼ˆæ•°å­¦åº§æ¨™ï¼‰
    const VIEW = {
      xMin: -8, xMax: 8,
      yMin: -6, yMax: 6
    };

    // ============================================
    // åˆæœŸåŒ–
    // ============================================
    function init() {
      canvas = document.getElementById('graphCanvas');
      ctx = canvas.getContext('2d');

      // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚ºã‚’è¦ªè¦ç´ ã«åˆã‚ã›ã‚‹
      resizeCanvas();
      window.addEventListener('resize', resizeCanvas);

      // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
      document.getElementById('sliderA').addEventListener('input', onSliderChange);
      document.getElementById('sliderP').addEventListener('input', onSliderChange);
      document.getElementById('sliderQ').addEventListener('input', onSliderChange);

      // ãƒ—ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
      document.querySelectorAll('.preset-btn').forEach(btn => {
        btn.addEventListener('click', onPresetClick);
      });

      // ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
      document.getElementById('resetBtn').addEventListener('click', resetParams);

      // åˆå›æç”»
      updateDisplay();
      draw();
    }

    // ============================================
    // ã‚­ãƒ£ãƒ³ãƒã‚¹ã®ãƒªã‚µã‚¤ã‚ºï¼ˆé«˜DPIå¯¾å¿œï¼‰
    // ============================================
    function resizeCanvas() {
      const container = canvas.parentElement;
      const dpr = window.devicePixelRatio || 1;

      const w = container.clientWidth;
      const h = container.clientHeight;

      canvas.width = w * dpr;
      canvas.height = h * dpr;
      canvas.style.width = w + 'px';
      canvas.style.height = h + 'px';

      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      draw();
    }

    // ============================================
    // åº§æ¨™å¤‰æ›ï¼ˆæ•°å­¦åº§æ¨™ â†” Canvasåº§æ¨™ï¼‰
    // ============================================
    function toCanvasX(mathX) {
      const w = canvas.clientWidth;
      return (mathX - VIEW.xMin) / (VIEW.xMax - VIEW.xMin) * w;
    }

    function toCanvasY(mathY) {
      const h = canvas.clientHeight;
      // Yè»¸ã¯åè»¢ï¼ˆæ•°å­¦åº§æ¨™ã¯ä¸ŠãŒæ­£ï¼‰
      return h - (mathY - VIEW.yMin) / (VIEW.yMax - VIEW.yMin) * h;
    }

    function toMathX(canvasX) {
      const w = canvas.clientWidth;
      return VIEW.xMin + (canvasX / w) * (VIEW.xMax - VIEW.xMin);
    }

    // ============================================
    // æç”»ãƒ¡ã‚¤ãƒ³
    // ============================================
    function draw() {
      const w = canvas.clientWidth;
      const h = canvas.clientHeight;

      // èƒŒæ™¯ã‚¯ãƒªã‚¢
      ctx.fillStyle = '#ffffff';
      ctx.fillRect(0, 0, w, h);

      drawGrid();
      drawAxes();
      drawAxisOfSymmetry();
      drawParabola();
      drawVertex();
    }

    // ã‚°ãƒªãƒƒãƒ‰ç·šã‚’æç”»
    function drawGrid() {
      ctx.strokeStyle = '#f1f5f9';
      ctx.lineWidth = 1;

      // ç¸¦ç·š
      for (let x = Math.ceil(VIEW.xMin); x <= VIEW.xMax; x++) {
        ctx.beginPath();
        ctx.moveTo(toCanvasX(x), 0);
        ctx.lineTo(toCanvasX(x), canvas.clientHeight);
        ctx.stroke();
      }

      // æ¨ªç·š
      for (let y = Math.ceil(VIEW.yMin); y <= VIEW.yMax; y++) {
        ctx.beginPath();
        ctx.moveTo(0, toCanvasY(y));
        ctx.lineTo(canvas.clientWidth, toCanvasY(y));
        ctx.stroke();
      }
    }

    // åº§æ¨™è»¸ã‚’æç”»
    function drawAxes() {
      ctx.strokeStyle = '#94a3b8';
      ctx.lineWidth = 2;

      // xè»¸
      ctx.beginPath();
      ctx.moveTo(0, toCanvasY(0));
      ctx.lineTo(canvas.clientWidth, toCanvasY(0));
      ctx.stroke();

      // yè»¸
      ctx.beginPath();
      ctx.moveTo(toCanvasX(0), 0);
      ctx.lineTo(toCanvasX(0), canvas.clientHeight);
      ctx.stroke();

      // è»¸ãƒ©ãƒ™ãƒ«
      ctx.fillStyle = '#64748b';
      ctx.font = '14px sans-serif';
      ctx.textAlign = 'left';
      ctx.textBaseline = 'top';
      ctx.fillText('x', canvas.clientWidth - 20, toCanvasY(0) + 8);
      ctx.textAlign = 'left';
      ctx.textBaseline = 'bottom';
      ctx.fillText('y', toCanvasX(0) + 8, 20);

      // ç›®ç››ã‚Šæ•°å­—
      ctx.font = '11px sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'top';

      for (let x = Math.ceil(VIEW.xMin); x <= VIEW.xMax; x++) {
        if (x !== 0) {
          ctx.fillText(x.toString(), toCanvasX(x), toCanvasY(0) + 6);
        }
      }

      ctx.textAlign = 'right';
      ctx.textBaseline = 'middle';
      for (let y = Math.ceil(VIEW.yMin); y <= VIEW.yMax; y++) {
        if (y !== 0) {
          ctx.fillText(y.toString(), toCanvasX(0) - 8, toCanvasY(y));
        }
      }

      // åŸç‚¹
      ctx.textAlign = 'right';
      ctx.textBaseline = 'top';
      ctx.fillText('O', toCanvasX(0) - 6, toCanvasY(0) + 6);
    }

    // å¯¾ç§°è»¸ã‚’æç”»
    function drawAxisOfSymmetry() {
      ctx.strokeStyle = '#f59e0b';
      ctx.lineWidth = 2;
      ctx.setLineDash([8, 6]);

      ctx.beginPath();
      ctx.moveTo(toCanvasX(p), 0);
      ctx.lineTo(toCanvasX(p), canvas.clientHeight);
      ctx.stroke();

      ctx.setLineDash([]);
    }

    // æ”¾ç‰©ç·šã‚’æç”»
    function drawParabola() {
      if (Math.abs(a) < 0.001) {
        // a â‰ˆ 0 ã®ã¨ãã€ç›´ç·š y = q ã‚’æç”»
        ctx.strokeStyle = '#3b82f6';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(0, toCanvasY(q));
        ctx.lineTo(canvas.clientWidth, toCanvasY(q));
        ctx.stroke();
        return;
      }

      ctx.strokeStyle = '#3b82f6';
      ctx.lineWidth = 3;
      ctx.beginPath();

      const step = 0.05;
      let first = true;

      for (let x = VIEW.xMin - 1; x <= VIEW.xMax + 1; x += step) {
        const y = a * Math.pow(x - p, 2) + q;

        // ç”»é¢å¤–ã«å¤§ããã¯ã¿å‡ºã™ã¨ãã¯ã‚¹ã‚­ãƒƒãƒ—
        if (y < VIEW.yMin - 10 || y > VIEW.yMax + 10) {
          first = true;
          continue;
        }

        const cx = toCanvasX(x);
        const cy = toCanvasY(y);

        if (first) {
          ctx.moveTo(cx, cy);
          first = false;
        } else {
          ctx.lineTo(cx, cy);
        }
      }

      ctx.stroke();
    }

    // é ‚ç‚¹ã‚’æç”»
    function drawVertex() {
      const cx = toCanvasX(p);
      const cy = toCanvasY(q);

      // å¤–å´ã®å††ï¼ˆã‚°ãƒ­ãƒ¼åŠ¹æœï¼‰
      ctx.beginPath();
      ctx.arc(cx, cy, 14, 0, Math.PI * 2);
      ctx.fillStyle = 'rgba(239, 68, 68, 0.2)';
      ctx.fill();

      // å†…å´ã®å††
      ctx.beginPath();
      ctx.arc(cx, cy, 8, 0, Math.PI * 2);
      ctx.fillStyle = '#ef4444';
      ctx.fill();

      // ç™½ã„ç¸å–ã‚Š
      ctx.strokeStyle = '#fff';
      ctx.lineWidth = 2;
      ctx.stroke();
    }

    // ============================================
    // UIæ›´æ–°
    // ============================================
    function onSliderChange() {
      a = parseFloat(document.getElementById('sliderA').value);
      p = parseFloat(document.getElementById('sliderP').value);
      q = parseFloat(document.getElementById('sliderQ').value);

      updateDisplay();
      draw();
    }

    function updateDisplay() {
      // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼å€¤ã®è¡¨ç¤ºã‚’æ›´æ–°
      document.getElementById('valueA').textContent = a.toFixed(1);
      document.getElementById('valueP').textContent = p.toFixed(1);
      document.getElementById('valueQ').textContent = q.toFixed(1);

      // å¼ã®è¡¨ç¤ºã‚’æ›´æ–°
      document.getElementById('formulaA').textContent = a.toFixed(1);
      document.getElementById('formulaP').textContent = formatNumber(p);
      document.getElementById('formulaQ').textContent = formatNumber(q);

      // é ‚ç‚¹åº§æ¨™
      document.getElementById('vertexX').textContent = p.toFixed(1);
      document.getElementById('vertexY').textContent = q.toFixed(1);

      // å‡¸ã®å‘ã
      const convexBadge = document.getElementById('convexBadge');
      const convexText = document.getElementById('convexText');
      if (a > 0) {
        convexText.textContent = 'ä¸‹ã«å‡¸ âˆª';
        convexBadge.className = 'info-badge convex-down';
      } else if (a < 0) {
        convexText.textContent = 'ä¸Šã«å‡¸ âˆ©';
        convexBadge.className = 'info-badge convex-up';
      } else {
        convexText.textContent = 'ç›´ç·šï¼ˆa = 0ï¼‰';
        convexBadge.className = 'info-badge';
      }

      // å¯¾ç§°è»¸
      document.getElementById('axisText').textContent = `x = ${p.toFixed(1)}`;
    }

    // æ•°å€¤ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆç¬¦å·ä»˜ãï¼‰
    function formatNumber(n) {
      if (n >= 0) return n.toFixed(1);
      return `(${n.toFixed(1)})`;
    }

    // ãƒ—ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
    function onPresetClick(e) {
      const btn = e.currentTarget;
      a = parseFloat(btn.dataset.a);
      p = parseFloat(btn.dataset.p);
      q = parseFloat(btn.dataset.q);

      // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®å€¤ã‚‚æ›´æ–°
      document.getElementById('sliderA').value = a;
      document.getElementById('sliderP').value = p;
      document.getElementById('sliderQ').value = q;

      updateDisplay();
      draw();
    }

    // ãƒªã‚»ãƒƒãƒˆ
    function resetParams() {
      a = 1;
      p = 0;
      q = 0;

      document.getElementById('sliderA').value = 1;
      document.getElementById('sliderP').value = 0;
      document.getElementById('sliderQ').value = 0;

      updateDisplay();
      draw();
    }

    // ============================================
    // èµ·å‹•
    // ============================================
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
